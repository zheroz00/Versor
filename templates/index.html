<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vector Converter</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:ital,opsz,wght@0,14..32,100..900;1,14..32,100..900&family=Orbitron:wght@400..900&display=swap"
        rel="stylesheet">

    <link rel="icon" type="image/x-icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-192.png') }}">
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#bf4408">

    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
    <div class="bg-decor">
        <!-- Abstract Vector Art Background Decoration -->
        <svg class="decor-item decor-1" viewBox="0 0 800 600" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M100 500 Q 300 100 700 300" stroke="var(--accent)" stroke-width="2" stroke-dasharray="8 4"
                opacity="0.3" />
            <circle cx="100" cy="500" r="4" fill="var(--accent)" />
            <circle cx="700" cy="300" r="4" fill="var(--accent)" />
            <line x1="300" y1="100" x2="100" y2="500" stroke="var(--text-muted)" stroke-width="1" opacity="0.2" />
            <rect x="296" y="96" width="8" height="8" fill="var(--text-muted)" opacity="0.5" />
        </svg>
        <svg class="decor-item decor-2" viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M50 350 L 350 350 L 350 50 L 50 50 Z" stroke="var(--accent)" stroke-width="1" opacity="0.1" />
            <path d="M50 350 L 350 50" stroke="var(--accent)" stroke-width="1" opacity="0.1" />
            <circle cx="200" cy="200" r="100" stroke="var(--accent)" stroke-width="1" opacity="0.1" />
        </svg>
        <svg class="decor-item decor-3" viewBox="0 0 200 200" fill="none" xmlns="http://www.w3.org/2000/svg">
            <line x1="0" y1="100" x2="200" y2="100" stroke="var(--accent)" stroke-width="1" />
            <line x1="100" y1="0" x2="100" y2="200" stroke="var(--accent)" stroke-width="1" />
            <circle cx="100" cy="100" r="5" stroke="var(--accent)" />
            <path
                d="M20 100 L 20 110 M 40 100 L 40 110 M 60 100 L 60 110 M 80 100 L 80 110 M 120 100 L 120 110 M 140 100 L 140 110 M 160 100 L 160 110 M 180 100 L 180 110"
                stroke="var(--accent)" stroke-width="1" />
        </svg>
        <svg class="decor-item decor-4" viewBox="0 0 400 400" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M200 50 L 350 350 L 50 350 Z" stroke="var(--accent)" stroke-width="1" />
            <path d="M200 50 L 200 350 M 50 350 L 350 350 M 350 350 L 200 50" stroke="var(--accent)"
                stroke-width="0.5" />
            <circle cx="200" cy="50" r="3" fill="var(--accent)" />
            <circle cx="350" cy="350" r="3" fill="var(--accent)" />
            <circle cx="50" cy="350" r="3" fill="var(--accent)" />
            <path d="M100 250 L 300 250 L 200 150 Z" stroke="var(--accent)" stroke-width="1" opacity="0.5" />
        </svg>
    </div>
    <div class="container">
        <h1>Vector Converter</h1>
        <p class="subtitle">Image to SVG for CNC Tool Paths</p>

        {% if dep_errors %}
        <div class="error-banner">
            <strong>Dependency Issues:</strong>
            <ul>
                {% for error in dep_errors %}
                <li>{{ error }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        {% if dep_warnings %}
        <div class="warning-banner">
            <strong>Optional Tools Missing:</strong>
            <ul>
                {% for warning in dep_warnings %}
                <li>{{ warning }}</li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="main-grid">
            <div class="panel">
                <h2>Input</h2>

                <div class="drop-zone" id="dropZone">
                    <div class="drop-zone-icon">+</div>
                    <p>Drop images here or click to browse</p>
                    <p style="font-size: 0.85em; margin-top: 5px;">PNG, JPG, BMP, GIF</p>
                    <input type="file" id="fileInput" multiple accept=".png,.jpg,.jpeg,.bmp,.gif">
                </div>

                <div class="file-list" id="fileList"></div>

                <h2>Method</h2>
                <div class="tab-container">
                    <button class="tab-btn active" data-method="potrace" {% if not available_methods.potrace
                        %}disabled{% endif %}>
                        Potrace
                    </button>
                    <button class="tab-btn" data-method="centerline" {% if not available_methods.centerline %}disabled{%
                        endif %}>
                        Centerline
                    </button>
                    <button class="tab-btn" data-method="vtracer" {% if not available_methods.vtracer %}disabled{% endif
                        %}>
                        vtracer
                    </button>
                </div>

                <!-- Potrace Tab -->
                <div class="tab-content active" id="tab-potrace">
                    <div class="method-description">
                        Outline tracing - converts images to outlined shapes. Best for solid graphics and CNC cutting.
                    </div>
                    <div class="preset-grid">
                        {% for key, preset in potrace_presets.items() %}
                        <button class="preset-btn {% if key == 'cnc_precise' %}active{% endif %}"
                            data-preset="{{ key }}" data-method="potrace" data-corner="{{ preset.corner_threshold }}"
                            data-optimize="{{ preset.optimize_tolerance }}" data-despeckle="{{ preset.despeckle }}"
                            data-threshold="{{ preset.threshold }}">
                            <div class="preset-name">{{ preset.name }}</div>
                            <div class="preset-desc">{{ preset.description }}</div>
                        </button>
                        {% endfor %}
                    </div>
                    <div class="custom-settings" id="customSettings-potrace">
                        <div class="setting-row">
                            <label>Corner Threshold</label>
                            <input type="range" id="cornerThreshold" min="0" max="1.5" step="0.1" value="0">
                            <span class="setting-value" id="cornerValue">0</span>
                        </div>
                        <div class="setting-row">
                            <label>Curve Optimization</label>
                            <input type="range" id="optimizeTolerance" min="0.01" max="1" step="0.01" value="0.1">
                            <span class="setting-value" id="optimizeValue">0.1</span>
                        </div>
                        <div class="setting-row">
                            <label>Despeckle Size</label>
                            <input type="range" id="despeckle" min="0" max="20" step="1" value="2">
                            <span class="setting-value" id="despeckleValue">2</span>
                        </div>
                        <div class="setting-row">
                            <label>B/W Threshold %</label>
                            <input type="range" id="threshold" min="10" max="90" step="5" value="50">
                            <span class="setting-value" id="thresholdValue">50</span>
                        </div>
                        <div class="setting-row checkbox-row">
                            <input type="checkbox" id="invert">
                            <label for="invert">Invert colors</label>
                        </div>
                    </div>
                </div>

                <!-- Centerline Tab -->
                <div class="tab-content" id="tab-centerline">
                    <div class="method-description">
                        Centerline tracing - produces single-line paths through the middle of strokes. Ideal for
                        engraving, text, and line art.
                    </div>
                    <div class="preset-grid">
                        {% for key, preset in centerline_presets.items() %}
                        <button class="preset-btn {% if key == 'line_art' %}active{% endif %}" data-preset="{{ key }}"
                            data-method="centerline" data-despeckle-level="{{ preset.despeckle_level }}"
                            data-corner="{{ preset.corner_threshold }}"
                            data-line-threshold="{{ preset.line_threshold }}" data-threshold="{{ preset.threshold }}">
                            <div class="preset-name">{{ preset.name }}</div>
                            <div class="preset-desc">{{ preset.description }}</div>
                        </button>
                        {% endfor %}
                    </div>
                    <div class="custom-settings" id="customSettings-centerline">
                        <div class="setting-row">
                            <label>Despeckle Level</label>
                            <input type="range" id="cl-despeckleLevel" min="0" max="10" step="1" value="2">
                            <span class="setting-value" id="cl-despeckleValue">2</span>
                        </div>
                        <div class="setting-row">
                            <label>Corner Threshold</label>
                            <input type="range" id="cl-cornerThreshold" min="50" max="180" step="5" value="100">
                            <span class="setting-value" id="cl-cornerValue">100</span>
                        </div>
                        <div class="setting-row">
                            <label>Line Threshold</label>
                            <input type="range" id="cl-lineThreshold" min="0.1" max="3" step="0.1" value="1.0">
                            <span class="setting-value" id="cl-lineValue">1.0</span>
                        </div>
                        <div class="setting-row">
                            <label>B/W Threshold %</label>
                            <input type="range" id="cl-threshold" min="10" max="90" step="5" value="50">
                            <span class="setting-value" id="cl-thresholdValue">50</span>
                        </div>
                        <div class="setting-row checkbox-row">
                            <input type="checkbox" id="cl-invert">
                            <label for="cl-invert">Invert colors</label>
                        </div>
                    </div>
                </div>

                <!-- vtracer Tab -->
                <div class="tab-content" id="tab-vtracer">
                    <div class="method-description">
                        Color/detail tracing - preserves colors and fine detail. Best for artwork, illustrations, and
                        pixel art.
                    </div>
                    <div class="preset-grid">
                        {% for key, preset in vtracer_presets.items() %}
                        <button class="preset-btn {% if key == 'smooth_color' %}active{% endif %}"
                            data-preset="{{ key }}" data-method="vtracer" data-mode="{{ preset.mode }}"
                            data-color-precision="{{ preset.color_precision }}"
                            data-gradient-step="{{ preset.gradient_step }}" data-corner="{{ preset.corner_threshold }}"
                            data-segment="{{ preset.segment_length }}" data-splice="{{ preset.splice_threshold }}"
                            data-filter-speckle="{{ preset.filter_speckle }}">
                            <div class="preset-name">{{ preset.name }}</div>
                            <div class="preset-desc">{{ preset.description }}</div>
                        </button>
                        {% endfor %}
                    </div>
                    <div class="custom-settings" id="customSettings-vtracer">
                        <div class="setting-row">
                            <label>Mode</label>
                            <select id="vt-mode">
                                <option value="polygon">Polygon (sharp)</option>
                                <option value="spline" selected>Spline (smooth)</option>
                            </select>
                        </div>
                        <div class="setting-row">
                            <label>Color Precision</label>
                            <input type="range" id="vt-colorPrecision" min="2" max="10" step="1" value="6">
                            <span class="setting-value" id="vt-colorValue">6</span>
                        </div>
                        <div class="setting-row">
                            <label>Gradient Step</label>
                            <input type="range" id="vt-gradientStep" min="2" max="32" step="2" value="8">
                            <span class="setting-value" id="vt-gradientValue">8</span>
                        </div>
                        <div class="setting-row">
                            <label>Corner Threshold</label>
                            <input type="range" id="vt-corner" min="15" max="180" step="5" value="60">
                            <span class="setting-value" id="vt-cornerValue">60</span>
                        </div>
                        <div class="setting-row">
                            <label>Segment Length</label>
                            <input type="range" id="vt-segment" min="2" max="16" step="1" value="4">
                            <span class="setting-value" id="vt-segmentValue">4</span>
                        </div>
                        <div class="setting-row">
                            <label>Splice Threshold</label>
                            <input type="range" id="vt-splice" min="15" max="90" step="5" value="45">
                            <span class="setting-value" id="vt-spliceValue">45</span>
                        </div>
                        <div class="setting-row">
                            <label>Filter Speckle</label>
                            <input type="range" id="vt-filterSpeckle" min="0" max="20" step="1" value="4">
                            <span class="setting-value" id="vt-filterValue">4</span>
                        </div>
                    </div>
                </div>

                <button class="convert-btn" id="convertBtn" disabled>Convert to SVG</button>
            </div>

            <div class="panel results-panel">
                <h2>Results</h2>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>Converting...</p>
                </div>

                <div id="results">
                    <div class="empty-state">
                        <div class="empty-state-icon">&#8680;</div>
                        <p>Converted files will appear here</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>

</html>